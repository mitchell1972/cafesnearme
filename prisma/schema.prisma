generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Cafe {
  id              String     @id @default(cuid())
  name            String
  slug            String     @unique
  description     String?
  address         String
  city            String
  area            String?
  postcode        String
  latitude        Float
  longitude       Float
  phone           String?
  website         String?
  email           String?
  amenities       String
  features        String
  openingHours    String?
  priceRange      String?
  rating          Float?     @default(0)
  reviewCount     Int        @default(0)
  thumbnail       String?
  images          String
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  favorites       Favorite[]
  reviews         Review[]

  @@index([postcode])
  @@index([city])
  @@index([area])
  @@index([latitude, longitude])
  @@index([slug])
}

model Review {
  id          String   @id @default(cuid())
  cafeId      String
  authorName  String
  authorEmail String?
  rating      Int
  comment     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  cafe        Cafe     @relation(fields: [cafeId], references: [id], onDelete: Cascade)

  @@index([cafeId])
}

model Favorite {
  id        String   @id @default(cuid())
  cafeId    String
  userId    String
  createdAt DateTime @default(now())
  cafe      Cafe     @relation(fields: [cafeId], references: [id], onDelete: Cascade)

  @@unique([cafeId, userId])
  @@index([userId])
}

model ImportLog {
  id          String   @id @default(cuid())
  filename    String
  status      String
  rowsTotal   Int
  rowsSuccess Int
  rowsFailed  Int
  errors      String?
  createdAt   DateTime @default(now())
}
